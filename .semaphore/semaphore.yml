version: v1.0
name: Using C in Semaphore 2.0
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804

blocks:
  - name: Change GCC version
    task:
      env_vars:
        - name: ZEPHYR_SDK_INSTALL_DIR
          value: "/opt/toolchains/zephyr-sdk-0.9.5"
        - name: ZEPHYR_TOOLCHAIN_VARIANT
          value: "zephyr"
        - name: DTC
          value: "/opt/toolchains/zephyr-sdk-0.9.5/sysroots/x86_64-pokysdk-linux/usr/bin/dtc"
      prologue:
        commands:
          - sem-version python 3.7
          - checkout
          - sudo ./install.sh
          - sudo pip3 install -r scripts/requirements.txt
          - sudo pip3 install wheel west sh
          - sudo mkdir -p /usr/local/bin
          - sudo cp /opt/toolchains/zephyr-sdk-0.9.5/sysroots/x86_64-pokysdk-linux/usr/bin/dtc /usr/local/bin
      jobs:
      - name: docker image
        commands:
          - source zephyr-env.sh
          - ./scripts/sanitycheck --inline-logs
